install
text
skipx
unsupported_hardware
eula --agreed

lang en_US.UTF-8
keyboard us
timezone --utc UTC

rootpw --plaintext vagrant
user --name vagrant --plaintext --password vagrant
sshkey --username vagrant "ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ== vagrant insecure public key"

network --device=bootif
firewall --disabled
selinux --disabled
bootloader --timeout 1 --append="no_timer_check console=tty0 console=ttyS0,115200n8 nopti noibrs noibpb spectre_v2=off mds=off mitigations=off biosdevname=0 net.ifnames=0 elevator=noop"


clearpart --all --initlabel
zerombr
part / --grow --label=root --asprimary


%packages --nobase --ignoremissing --excludedocs --instLangs=en
@Core --nodefaults
rsync
-*-firmware
-acl
-audit
-authconfig
-biosdevname
-btrfs-progs
-chrony
-dosfstools
-dracut-config-rescue
-dracut-network
-e2fsprogs
-firewalld
-iprutils
-irqbalance
-kbd
-kernel-tools
-kexec-tools
-less
-libselinux-utils
-linux-firmware
-man-db
-microcode_ctl
-NetworkManager*
-NetworkManager-config-server
-plymouth
-policycoreutils
-polkit
-postfix
-Red_Hat_Enterprise_Linux-Release_Notes-7-en-US
-redhat-support-tool
-selinux-policy
-selinux-policy-targeted
-sg3_utils
-sg3_utils-libs
%end

%post
cat > /etc/sudoers.d/vagrant << EOF
Defaults:vagrant env_keep += "SSH_AUTH_SOCK"
Defaults:vagrant !requiretty
vagrant ALL=(ALL) NOPASSWD: ALL
EOF
chmod 0440 /etc/sudoers.d/vagrant
%end

%addon com_redhat_kdump --disable
%end

firstboot --disabled
reboot --eject
